load("mssql-jdbc-7.0.0.jre8.jar")
from com.ziclix.python.sql import zxJDBC
from datetime import datetime
import sys

user_portal = "anv_cquispea"
pass_portal = "PaSsWk2020"
user_entel = "EXTCQUISPEA"
pass_entel = "140120"

conn = None
d, u, p, v = "jdbc:sqlserver://10.120.25.80", "ENVIRONMENT_PRD", "@env-PRD-2015$#", "com.microsoft.sqlserver.jdbc.SQLServerDriver"

print("cerrar procesos")
type("r",KeyModifier.WIN)
sleep(2)
type("cmd")
type(Key.ENTER)
sleep(3)
paste(r'taskkill /F /IM firefox.exe')
sleep(2)
type(Key.ENTER)
sleep(2)
paste(r'taskkill /F /IM iexplore.exe')
sleep(2)
type(Key.ENTER)
sleep(3)
type("exit")
sleep(2)
type(Key.ENTER)
sleep(2)

print("abrir firefox")
sleep(2)
type("r",KeyModifier.WIN)
sleep(3)
paste("firefox")
sleep(2)
type(Key.ENTER)
sleep(10)

print("Ingresar pagina")
wait("1572464723460.png",120)
sleep(2)
click(Pattern("1572464723460.png").targetOffset(11,4),120)
sleep(3)

print("Ingresar asr")
wait("1568325519771.png",120)
sleep(2)
paste(Pattern("1568325557140.png").targetOffset(47,-22),user_asr)
sleep(2)
type(Key.TAB)
sleep(2)
paste(pass_asr)
sleep(2)
type(Key.ENTER)
sleep(7)
click(Pattern("1568325668527.png").targetOffset(0,5))
sleep(15)

print("inicio exportar datos")
type('l',Key.CTRL)
sleep(2)
paste(link_rpa)
sleep(2)
type(Key.ENTER)
sleep(5)

print("inicio obtener ordenes")
while True:
    wait("1569367084080.png",60)
    click(Pattern("1569367173955.png").targetOffset(-98,2))
    sleep(5)
    if exists(Pattern("1569368683554.png").similar(0.90),10):
        sleep(5)
        type("t", KEY_CTRL)
        sleep(5)
        type("l", KEY_CTRL)
        sleep(3)
        paste(link_et)
        sleep(2)
        type(Key.ENTER)
        sleep(7)
        type(Key.TAB, KEY_CTRL)
        sleep(3)
        click(Pattern("1569336660386-1.png").targetOffset(-38,-37))
        sleep(3)
        type(Key.TAB, KEY_CTRL)
        sleep(3)
        click(Pattern("1569446320926.png").targetOffset(-139,17))
        sleep(2)
        type(Pattern("1569446392107.png").targetOffset(57,1),'v',KEY_CTRL)
        sleep(2)
        click(Pattern("1569446628469.png").targetOffset(0,2))
        sleep(3)
        click(Pattern("1569446661853.png").targetOffset(-45,1))
        sleep(8)
        
        if exists(Pattern("1569446881469.png").targetOffset(1,2)):
            sleep(2)
            click(Pattern("1569446881469.png").targetOffset(1,2))
            sleep(3)

        elif exists ("1576770529044.png"):
            sleep(2)
            click("1576770529044.png")
            sleep(3)

        else:
            sleep(3)
            type(Key.ENTER)
            sleep(3)
            
        type("w",KEY_CTRL)
        sleep(3)
        
        print("abrir iexplorer")
        type("r",KeyModifier.WIN)
        sleep(3)
        paste("iexplore")
        sleep(2)
        type(Key.ENTER)
        sleep(10)
        if exists("1576879424332.png"):
            sleep(2)
            click(Pattern("1576879424332.png").targetOffset(-4,-17))
            sleep(5)
            
        
        print("Ingresar Portal")
        wait("1568303506821.png",120)
        sleep(3)
        paste(Pattern("1568303696409.png").targetOffset(65,-12), user_portal)
        sleep(2)
        type(Key.TAB)
        sleep(2)
        paste(pass_portal)
        sleep(2)
        type(Key.ENTER)
        sleep(10)
        if exists ("1568322894042.png",10):
            click(Pattern("1568323065585.png").targetOffset(0,1))
            sleep(2)
            click(Pattern("1568323106628.png").targetOffset(-56,2))
            sleep(10)
            
        click(Pattern("1569512860676.png").similar(0.80).targetOffset(3,9))
        sleep(10)
        click("1576872194943.png")
        sleep(3)
        type('w',Key.CTRL)
        sleep(10)
        
        print("ingresar al portal")
        type(Key.TAB, KEY_CTRL)
        sleep(3)
        type(Key.UP, KeyModifier.WIN)
        sleep(3)
        paste(Pattern("1568321503727.png").targetOffset(40,-11), user_entel)
        sleep(2)
        type(Key.TAB)
        sleep(2)
        paste(pass_entel)
        sleep(2)
        type(Key.ENTER)
        sleep(3)
        if exists ("1568324732583.png",120):
            sleep(2)
            click(Pattern("1568324773276.png").targetOffset(-55,1))
            sleep(2)
        
        print("abrir modulo")
        wait("1568323949843.png",120)
        sleep(2)
        click(Pattern("1568323985698.png").targetOffset(23,1))
        sleep(2)
        click(Pattern("1568324133635.png").targetOffset(68,2))
        sleep(10)
        
        print("Ingreso de datos")
        type(Key.TAB,KEY_ALT)
        sleep(3)
        click(Pattern("1569336660386.png").targetOffset(-32,-11))
        sleep(2)
        type(Key.TAB,KEY_ALT)
        sleep(5)
        type(Pattern("1568760487864.png").similar(0.80).targetOffset(-48,9),'v',KEY_CTRL)
        sleep(3)
        type(Key.ENTER)
        sleep(15)
        if exists("1568761138131.png",15):
            click(Pattern("1568761138131.png").targetOffset(109,-1))
            sleep(2)
    
        print("ingresar datos contacto")
        click(Pattern("1568761510523.png").targetOffset(214,13))
        sleep(3)
        click(Pattern("1568761607782.png").targetOffset(-56,-3))
        sleep(3)
        if exists("1568761138131.png",15):
            click(Pattern("1568761138131.png").targetOffset(109,-1))
            sleep(2)        
        type(Key.TAB,KEY_ALT)
        sleep(3)
        click(Pattern("1569336660386.png").targetOffset(-6,14))
        sleep(2)
        type(Key.TAB,KEY_ALT)
        sleep(3)
        type(Pattern("1568764411275.png").targetOffset(102,2),'v',KEY_CTRL)
        sleep(2)
        type(Key.TAB)
        sleep(2)
        type('v',KEY_CTRL)
        sleep(2)
        type(Key.TAB,KEY_ALT)
        sleep(3)
        click(Pattern("1569336660386.png").targetOffset(-4,41))
        sleep(2)
        type(Key.TAB,KEY_ALT)
        sleep(3)
        type(Pattern("1568764563603.png").targetOffset(101,0),'v',KEY_CTRL)
        sleep(2)
        type(Key.TAB,KEY_ALT)
        sleep(3)
        click(Pattern("1569336660386.png").targetOffset(-24,68))
        sleep(2)
        type(Key.TAB,KEY_ALT)
    
        print("ingresar descripcion")
        sleep(3)
        click(Pattern("1568764827739.png").targetOffset(95,-12))
        sleep(2)
        type('v',KEY_CTRL)
        sleep(2)
        click(Pattern("1568821737641-1.png").targetOffset(-1,28))
        sleep(2)
        type(Key.END)
        sleep(5)
        click(Pattern("1568821971430.png").targetOffset(2,0))
        sleep(15)
    
        print("crear incidente")
        click(Pattern("1573230252336.png").targetOffset(82,15))
        sleep(3)
        click(Pattern("1568823329808-1.png").targetOffset(0,8))
        sleep(3)
        type(Key.TAB)
        sleep(3)
        click(Pattern("1569014535329-1.png").targetOffset(140,6))
        sleep(3)
        click(Pattern("1568823592994-1.png").targetOffset(-58,26))
        sleep(2)
        type(Key.TAB)
        sleep(3)
        click("1569014627556.png")
        sleep(3)
        click(Pattern("1568823890121-1.png").targetOffset(-17,20))
        sleep(3)
        type(Key.TAB)
        sleep(3)
        click(Pattern("1569020990460.png").targetOffset(104,7))
        sleep(3)
        click(Pattern("1568824106526.png").targetOffset(-20,14))
        sleep(3)
        type(Key.TAB)
        sleep(3)
        type(Key.TAB)
        sleep(4)
        click(Pattern("1569021872330.png").targetOffset(90,7))
        sleep(3)
        click(Pattern("1568824333339.png").targetOffset(-13,13))
        sleep(3)
        click(Pattern("1569021984006.png").targetOffset(80,2))
        sleep(3)
        click(Pattern("1568824440751.png").targetOffset(-45,17))
        sleep(2)
        click(Pattern("1568825162977.png").targetOffset(0,-10))
        sleep(2)
        click(Pattern("1568824514249.png").targetOffset(73,8))
        sleep(3)
        click(Pattern("1568825470455.png").targetOffset(-26,30))
        sleep(2)
    
        print("grabar incidente")
        type(Key.TAB,KEY_ALT)
        sleep(2)
        click(Pattern("1569336660386.png").targetOffset(-31,14))
        sleep(2)
        type(Key.TAB,KEY_ALT)
        sleep(2)
        type(Pattern("1568825633671.png").similar(0.80).targetOffset(165,12),'v',KEY_CTRL)
        sleep(2)
        type(Key.TAB,KEY_ALT)
        sleep(2)
        click(Pattern("1569336660386.png").targetOffset(-33,41))
        sleep(2)
        type(Key.TAB,KEY_ALT)
        sleep(2)
        type(Pattern("1568825719627.png").targetOffset(162,-10),'v',KEY_CTRL)
        sleep(3)
        print("grabar")
        click(Pattern("1569533949500.png").targetOffset(-64,64))
        sleep(15)
        click(Pattern("1569538020102.png").targetOffset(-1,0))
        sleep(5)
        click(Pattern("1569336660386.png").targetOffset(-32,-11))
        sleep(3)
        type(Key.TAB,KEY_ALT)
        sleep(3)
        type(Pattern("1569539538068.png").targetOffset(78,13),'v',KEY_CTRL)
        sleep(3)
        type(Key.TAB)
        sleep(30)
        if exists("1570750600130.png",10):
            sleep(2)
            click("1570750600130.png")
            sleep(2)
            click(Pattern("1570750692717.png").targetOffset(-1,-3))
        else:
            type(Key.TAB,KEY_ALT)
            sleep(5)
            click(Pattern("1569336660386.png").targetOffset(-21,67))
            sleep(3)
            type(Key.TAB,KEY_ALT)
            sleep(3)
            type(Pattern("1569541011218.png").targetOffset(73,2),'v',KEY_CTRL)
            sleep(3)        
            click(Pattern("1569538559738.png").targetOffset(-26,-2))
            sleep(5)        
            click(Pattern("1569538559738.png").targetOffset(34,-2))        
            sleep(5)
        type(Key.TAB,KEY_ALT)
        sleep(3)
        click(Pattern("1568825760289.png").targetOffset(3,1))
        sleep(10)
        type(Key.ENTER)
        sleep(10)
    
        print("registrar id incidente")
        doubleClick(Pattern("1568826020877.png").targetOffset(-10,26))
        sleep(2)
        type('c',KEY_CTRL)
        sleep(3)
        type(Key.TAB,KEY_ALT)
        sleep(2)
        type(Pattern("1569336837588.png").targetOffset(81,-1),'v',KEY_CTRL)
        sleep(3)
        click(Pattern("1568827013982.png").targetOffset(71,3))
        sleep(3)
        click(Pattern("1568827071526.png").targetOffset(27,33))
        sleep(3)
        type('l',Key.CTRL)
        sleep(2)
        paste(link_rpa)
        sleep(2)
        type(Key.ENTER)
        sleep(5)
        type(Key.TAB,KEY_ALT)
        sleep(5)
        type("w",KEY_CTRL)
        sleep(5)

    else:
        print("no existen pendientes")
        sleep(2)
        type("w",KEY_CTRL)
        break

print("FIN RPA")
 